# Nuxt.js における SCSS設計 と FLOCSS

## CSS 設計の必要性

大規模なページのコーディングを、無秩序に複数人で実施すると、
サイトのコードが読みにくくなるだけでなく、変更に弱い複雑な CSS 構造が生まれてしまいます。

Web サイトは制作後も継続的に運用されるものですので、
保守性を意識し、後から見ても読みやすい、変更しやすいコードを維持することが非常に重要です。

複数人で CSS を記述する上で、「どこに何を記述するか」の指針を与えるものとして、
様々な「CSS設計」と呼ばれるルールが存在しています。

### FLOCSS 

FLOCSSはCSS設計手法の1つです。

FLOCSSの詳細設計はGitHub上にて確認することができます。

> FLOCSS（フロックス） は、OOCSSやSMACSS、BEM、SuitCSSのコンセプトを取り入れた、
モジュラーなアプローチのためのCSS構成案です。

FLOCSS では、様々な CSS 設計のアプローチを踏襲しながら、
いろいろなプロジェクトで適用しやすい CSS 設計ルールの形を提供してくれます。

FLOCSS で定義されているルールの全容は以下から参照可能となっていますので、
ここでは、 FLOCSS で定義されるルールの中で主要なエッセンスについてのみ、確認していきます。

https://github.com/hiloki/flocss


## FLOCSSのレイヤー設計

複数ページのサイトを CSS でコーディングする場合、
通常 デザイン上の役割毎にいくつかのレイヤー分割を行って、CSSを役割ごとに記述していきます。

FLOCSSではCSSのレイヤーとして以下のようなものが用意されています。

- Foundation - reset/normalize/base...
- Layout - header/main/sidebar/footer...
- Object
  - Component - grid/button/form/media...
  - Project - articles/ranking/promo...
  - Utility - clearfix/display/margin...

Foundationはサイト全体に関わるCSSの領域です。ベースの文字設定や、CSS リセットなどがここに含まれます。

Layout はサイト全体で利用する、ページの主要なレイアウトに関する記述です。

Object 内の Componentは複数のページにまたがって利用されるようなコンポーネント要素に関する記述です。

対して Object 内の Projectは 各ページ単位でのみ利用されるCSSの領域です。

サイト全体で利用されるようなヘルパークラス等は Object の Utility に配置します。

こうしたレイヤー構造がコーディング上で意識できるよう、 Nuxt.js で SCSS を記述する際にも、
FLOCSS に合わせたフォルダ構造を作成します。

```text
assets/scss
  /foundation
    base.scss -> ベースのフォントサイズ等を記述
    reset.scss -> リセットCSS を記述
  /layout
    layout.scss -> サイト全体のレイアウトを定義
  /Object
    /Component
      button.scss -> サイト全体で使用する ボタン状の UI 要素を記述
    /Project
      top.scss -> トップページの SCSS を記述
      about.scss -> アバウトページの SCSS を記述
    /Utility
      margin.scss -> サイト全体で利用する mt-20 等の クラスを定義
  common.scss -> 上記すべての scss を 取りまとめる scss ファイル
```

また、Nuxt.js のプロジェクトでは、vue の Scoped CSS を利用して、以下のような運用が可能かもしれません。

- layout の定義は `layout` フォルダ内の vue コンポーネントで定義する。
- Project のような、ページごとの CSS 定義は `pages` フォルダ内の vue コンポーネントで定義する。

このようなケースでは、以下のような形で SCSS の運用が可能です。

```text
assets/scss
  /foundation
    base.scss -> ベースのフォントサイズ等を記述
    reset.scss -> リセットCSS を記述
  /Object
    /Component
      button.scss -> サイト全体で使用する ボタン状の UI 要素を記述
    /Utility
      margin.scss -> サイト全体で利用する mt-20 等の クラスを定義
  common.scss -> 上記すべての scss を 取りまとめる scss ファイル
```

## BEMとクラス命名規則

### BEM 

BEM は 様々なプロジェクトで利用されている、基本的なクラスの命名規則です。
FLOCSS でもこの BEM ベースのクラス命名ルールが採用されます。

BEMではクラスの命名を `Block` `Element` `Modifier` の３つの要素から考えます。
`Block` は要素の大きなグループを表し、`Element` は `Block` 内の小要素を表します。
`Modifier` は既存の、`Block` や `Element` に対して、通常の状態とは異なる別パターンの状態を表すものです。

BEM による CSS の命名ルールは、これら、`Block` `Element` `Modifier` を用いて以下の形で表現します。

```text
.block
.block__element
.block--modifier
.block__element--modifier
```
 
- block は単体でクラスにすることができる。
- element は `__` で接続して、block と共に用いる
- modifier は `--` で接続して、block か element とともに用いる

こうしたクラス名を用いてHTML を記述すると以下のようになります。

```html
<div class="button">
  <span class="button__text"> 次へ </span>
  <i class="button__icon"/>
</div>

<div class="button">
  <i class="button__icon--left"/>
  <span class="button__text"> 戻る </span>
</div>
```

elementクラスを HTML 要素内で クラスに割り当てるとき、
必ず対応する blockクラスを持つ要素が親として存在している必要があります。
上記の例では `.button__text` や `.button__icon` が element を用いたクラス名ですが、
対応するblockクラスの `.button` 要素 の中でのみ利用されています。

BEM を利用する上では、`.button` クラスの存在しないところで、
`.button__text` などの elementクラスの利用することは禁止されます。
クラスの命名を BEM に沿って運用することで、
CSSクラスの管理を block クラス単位でまとめて行えるような工夫がルール化されています。

SCSS を用いる場合 CSS の管理も block で行うことができるようになります。
BEM ベースの上記のようなHTML のCSS は SCSS を用いて以下のように記述できます。

```scss
.button{
  border: 1px solid $btnBorder;
  &__text{
    // ...
  }
  &__icon{
    // ...
  }
  &__icon--left{
    // ...
  }  
}
```

SCSS の記述も block 単位で入れ子にまとめることが可能なため、
一つ一つのクラスに対して、個別に `{ }` を切る形の記述より、
コードの管理は格段に容易になります。

::: tip
block は CSS の管理を容易にするために存在しているため、
block の中に多数の element が入り込むような大きな block の定義は極力さけ、
適切な単位の block に分割してコードを記述するよう心がけましょう。
:::

### FLOCSS における BEM 

FLOCSS では `Block` `Element` `Modifier` に加えて、 `c-` `p-` `l-` `u-` の接頭辞が導入されます。

- `c-` Object/Component に所属する CSS のルールに対するクラス
- `p-` Object/Project に所属する CSS のルールに対するクラス
- `l-` Layout に所属する CSS のルールに対するクラス
- `u-` Object/Utility に所属する CSS のルールに対するクラス

これにより、例えば 接頭辞 `c-` を用いる場合のクラスの命名は以下のような形になります。

```text
.c-block
.c-block__element
.c-block--modifier
.c-block__element--modifier
```

また FLOCSS では、 BEM で複雑になりがちな `Modifier` の運用を破棄して、
`is-` 接頭辞を利用した運用も許容されています。

先程の `--left` Modifierを利用したクラス名は以下のような形で書き換えが可能です。

```
<div class="button">
  <i class="button__icon is-left"/>
  <span class="button__text"> 戻る </span>
</div>
```

## クラスの命名方針について

クラスの命名を行う時に、何に名前をつけるか、というのはとても重要な視点です。
一般にクラス名の付け方は、以下の3つの観点で行われます。

- 見た目、スタイルに対する命名
- UIや機能上の要素に対する命名
- ページ上の意味合いに対する命名

お問い合わせフォームの画面で、

- フォームのエラーメッセージとして文字を赤くする装飾
- フォームの送信ボタンとして、枠付きのボタン要素を表示する装飾

を実装するケースで、それぞれの命名方法を確認していきましょう。

### 見た目、スタイルに対する命名

エラーメッセージを `red`、枠付きのボタンを `bordered` などのようにして、
見た目や付与されるスタイルに合わせてクラス命名を行う方法です。 
 
わかりやすく、利用しやすい一方で共通のCSS部分のメンテナンスが難しく、
HTML要素に付与されるクラスも多くなりがちと言った問題があります。
 
運用上の理由で、例えば `red` に `font-weight` が設定されてしまったり、
多様な赤を表現するために、`red` の他に `red2` `red3` などのクラスが生まれるなどの事故も起こりやすく、
管理がとても複雑になる、といった問題もあります。

また、デザインとHTMLコードは強固に結びついているため、
デザインの変更に対して、HTMLの修正も頻繁に起こりやすくなる傾向があります。

CSSを記述するような感覚でクラス名を付与してHTMLのコーディングができるため、
感覚的には利用しやすく便利ですが、 CSSは必要に応じて都度継ぎ足され、また既存のCSS定義の修正もしずらく
複雑になりがちなため、大きなプロジェクトでは利用を避けるほうが良いでしょう。

一方で CSS のフレームワーク等ではよく用いられる命名方針でもあり、
プロジェクト内でも個別にマージンの記述するのが 面倒という理由で、
`u-mt20` などのマージンに対するクラス名をつけて運用するようなケースも見られます。

FLOCSS では、Object/Utility 層でのみこのような考え方の クラス命名が許容されています。

### UIや機能上の要素に対する命名
 
エラーメッセージを `error-message`、ボタンを `btn` などのようにして、
UI の役割に対してクラス命名を行う方法です。 
 
サイト内で利用されているUI間で見た目が常に同じとなることが保証されるため、
コンポーネントベースでのデザインを表現する上でとても便利です。
 
逆にコンポーネントを意識しないデザインに置いて、
同じUIが、細部異なる見た目を持っている…といったケースでは対応が困難になってきます。

コンポーネントの設計を行っていたとしても、
同じボタン群で、色や大きさのバリエーションなどの違いがあるケースもあるため、
バリエーションの管理には工夫が必要です。

またレイアウト上の位置によって、同じUIでも異なるマージンを持つケースも考えられます。
このようなレイアウト上の設計をどれだけ緻密に行い、顧客と共有できるかがコンポーネント設計の鍵となってくるでしょう。

デザインとHTMLコードの結びつきは比較的緩やかになっているため、
デザインの変更があっても、単純なUI上の見た目の変化はCSSのみの修正で実装できるでしょう。

一般的なCSSフレームワークなどはこの思想をベースにCSSが記述されています。

FLOCSS では、Object/Component 層で、このような考え方のクラス命名を用いるのが良いでしょう。
 
### ページ上の意味合いに対する命名

お問い合わせフォーム、というページ上の意味合いを重視し、
エラーメッセージを `form-error-message`、ボタンを `form-action` などのようにして、
ページの内容に沿ったクラス命名を行う方法です。 

ページ上の意味合いをベースに名前をつける場合、
HTML上のクラスはそれぞれの文脈に応じて（たとえ同じ見た目であっても！）個別のクラス名が付与されるため、
クラス名の再利用はほとんどされなくなります。

「何が共通化されるべきで、何を共通化すべきでないか」の検討は、ときに非常に困難であるケースもあるため、
こうしたベージ毎に個別のクラスの命名を行うことも可能で、クラス名の再利用によって生じるような、
サイト全体の管理の複雑さはHTML上から取り除かれます。

一方で、CSSの容量は大きくなりがちなため、SCSSの `@extend` を利用した工夫などが必要になるケースもあるでしょう。
見た目が同じでも異なるクラス名が利用されるため、サイト全体で統一した色やサイズを利用したい場合に
SCSSの変数等を利用した管理も不可欠になってきます。

アウトラインベースで名前をつける考え方の設計としてはECSSの考え方が参考になります。

[http://ecss.io/](http://ecss.io/) 

FLOCSS では、Object/Project 層でこのような考え方のクラス命名を用いると良いでしょう。

### OOCSSの考え方
 
クラスの命名に関するべつの考え方として、OOCSS と呼ばれるものも存在します。

OOCSS(Object Oriented CSS)は、CSS上でUIコンポーネントを表現する上でのクラス設計の考え方で、
UIを構成する要素を、構造と見た目に分けて2つのクラス名で表現します。

https://codepen.io/mikakane/pen/aPjQZR/ 

上記例では、 `btn` クラスは、 ボタン要素の構造を、
`btn-red` `btn-blue` 要素はボタン要素の見た目を提供しています。 

このようにUI要素の構造と見た目を分けて管理することで、1つのCSS群から、
複数のバリエーションを表現する事が可能になります。

この考え方はSCSSにおけるmixinの設計でも非常に重要なものとなりますので、
概念としてはしっかり理解しておくほうが良いでしょう。

OOCSS のより詳しい考え方は以下のサイトを参照してください。

[http://oocss.org/](http://oocss.org/)

## シングルクラスか、マルチクラスか

CSSでhtmlに装飾を加える場合、クラス名を用いてhtmlとCSSの紐付けを行います。
クラス名は、その命名規則以外にも、HTML上でどのように利用するか、についても色々な考え方があります。

シングルクラスは全てのhtml要素が、ただ一つのみのクラス名を持つべき、とする考え方です。

一方で、マルチクラスでは、html要素が複数のクラス名を持つことを許容します。

Bootstrapを用いたコーディングでは、複数のクラス名を組み合わせて一つのデザインを再現する考え方が頻繁に利用されており、
マルチクラス寄りのCSS設計と言えるでしょう。

FLOCSSでは原則、シングルクラスベースのクラス命名を採用しており、
通常、BEMをベースに進められるプロジェクトでは、シングルクラスベースの考え方が重視されます。

ただ、前述の通り、例外的に、modifier的要素を `is-` 接頭辞で実装して、
マルチクラス的な運用をすることもFLOCSSでは、許容されており、
このケースに置いては一つのhtml要素が 複数のクラス名を持つことを許容されます。

## クラスの再利用を許可するかどうか

複数のページからなるサイト制作において、クラスの再利用を許可するかどうかは、
CSS記述を保守運用していく上で非常に重要なポイントです。

クラスの再利用を許可しない場合、複数のページで同じ見た目を持つような要素も異なるクラス名で、
個別のCSS を用いて実装されます。

FLOCSS では、再利用を許容する/しない を Objectの Component/Project レイヤで明確に区別しており、
クラス名の上でも `c-` / `p-` を用いて明示的に表現することが可能です。

特定のページでのみ利用されることが想定されるものは、`c-` 接頭辞で記述すべきではありませんし、
`p-` 接頭辞で記述されるスタイルを複数のページでまたがって記述することは許容されません。

もっとも、 Scoped CSS で記述する内容は ページをまたがって共有することができないため、
Object/Project の内容を vue コンポーネントの Scoped CSS で記述するよう運用する場合は、
`p-` 接頭辞のスタイルが他方で再利用されることについて心配する必要はありません。

